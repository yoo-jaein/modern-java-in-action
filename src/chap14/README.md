# Chapter 14 자바 모듈 시스템

## 관심사분리
관심사분리(SoC, Separation of Concerns)는 컴퓨터 프로그램을 고유의 기능으로 나누는 동작을 권장하는 원칙이다. SoC 원칙은 다음과 같은 장점을 제공한다.
- 개별 기능을 따로 작업할 수 있어 협업에 좋다.
- 개별 부분을 재사용하기 쉽다.
- 전체 시스템을 쉽게 유지보수할 수 있다.

다양한 형식으로 구성된 지출을 파싱하고, 분석한 다음, 결과를 요약하는 회계 애플리케이션을 개발한다고 가정하자. SoC를 적용하면 파싱, 분석, 레포트 기능을 모듈이라는 각각의 그룹으로 분리할 수 있다. 자바 9의 모듈을 이용하면 클래스가 어떤 다른 클래스를 볼 수 있는지를 정교하게 제어할 수 있다.

## 모듈화의 한계
자바 9 이전까지는 모듈화된 소프트웨어 프로젝트를 만드는 데 한계가 있었다. 자바는 클래스, 패키지, JAR 세 가지 수준의 코드 그룹화를 제공하는데, 클래스 수준에서는 접근 제한자와 캡슐화를 지원했지만 패키지와 JAR 수준에서는 캡슐화를 거의 지원하지 않았기 때문이다.

### 패키지에서의 가시성 제어 문제
자바는 public, protected, default(패키지 수준), private의 네 가지 가시성 접근자를 제공한다. 한 패키지의 클래스와 인터페이스를 다른 패키지에 공개하려면 이들을 public으로 선언해야 한다. 그러면 이 클래스와 인터페이스는 모든 패키지에 공개된다.

### 클래스 경로 문제
자바는 애플리케이션을 번들하고 실행하는 기능과 관련해 태생적으로 약점을 갖고 있다. 클래스를 모두 컴파일한 다음 보통 한 개의 평범한 JAR 파일에 넣고 클래스 경로에 이 JAR 파일을 추가해 사용한다. 그러면 JVM이 동적으로 클래스 경로에 정의된 클래스를 필요할 때 읽는다.  

클래스 경로와 JAR 조합에는 몇 가지 약점이 있다.
- 같은 클래스를 구분하는 버전 개념이 없다. 클래스 경로에 두 가지 버전의 같은 라이브러리가 존재할 때 어떤 일이 일어날지 예측할 수 없다.
- 명시적인 의존성을 지원하지 않는다. 각각의 JAR 안에 있는 모든 클래스는 classes라는 한 주머니로 합쳐진다. 한 JAR가 다른 JAR에 포함된 클래스를 사용하라고 명시적으로 의존성을 정의하는 기능을 제공하지 않는다.

## 자바 개발 키트
자바 개발 키트(JDK)는 자바 프로그램을 만들고 실행하는 데 도움을 주는 도구의 집합이다.
- javac : 자바 프로그램을 컴파일하는 도구
- java : 자바 애플리케이션을 로드하고 실행하는 도구
- 입출력을 포함해 런타임 지원을 제공하는 JDK 라이브러리, 컬렉션 스트림 등

자바 9 이전에는 모든 Java Platform API들을 애플리케이션에 패키징해야 했다. 예를 들어, java.desktop과 java.corba를 사용하지 않는 애플리케이션에서도 해당 라이브러리들이 포함되어 애플리케이션이 불필요하게 커졌다. 이는 모바일같이 JDK 전부를 필요로 하지 않는 시스템에서 문제가 되었다. 따라서 JDK에서도 모듈 시스템 설계의 필요성이 제기되었다. 자바 9 모듈을 통해 Java Platform API는 별도의 모듈들로 쪼개졌고, 애플리케이션에서 사용하는 모듈만 모아 런타임 이미지를 만들 수 있게 되었다. 

## 모듈
자바 9는 모듈이라는 새로운 자바 프로그램 구조 단위를 제공한다. 모듈 시스템은 직소(Jigsaw) 프로젝트 내부에서 개발된 기능으로, 2017년 자바 9 기능으로 완성되기까지 거의 십 년이 걸렸다.  

자바 9 모듈은 다음의 특징을 가진다.
- module이라는 새 키워드에 이름과 바디를 추가해서 정의한다.
- 모듈 디스크립터(module discriptor)는 module-info.java라는 특별한 파일에 저장된다.
- module, requires, export 등 자바 9의 모듈 관련 용어는 제한된 키워드(restricted keywords)다. 모듈이 허용된 곳에서만 이들 용어가 키워드로 해석된다.
- 모듈의 이름은 유니크해야 하며, 충돌을 피하기 위해 인터넷 도메인명을 역순으로 사용하는 규칙(예: com.example.module)을 권장한다.
- 모듈 경로에 포함된 JAR 중에 module-info 파일을 포함하지 않는 모든 JAR는 자동 모듈이 된다. 자동 모듈은 암묵적으로 모든 패키지를 공개한다.

### module-info.java
모듈 디스크립터 module-info.java는 모듈을 정의하는 파일이다. 위치는 그 모듈의 루트 디렉토리이다. 

- 모듈의 이름은 무엇인가? (name)
- 이 모듈은 어떤 것을 제공하는가? (export)
- 이 모듈은 어떤 것들을 필요로 하는가? (require)

1. 자바의 모듈은 모듈의 어떤 자바 패키지가 다른 모듈로 제공될지 명시해야 한다. 이는 export 문을 사용한다. 기본적으로 public 클래스라도 export 패키지 목록에 포함되지 않으면 해당 모듈의 외부로 공개되지 않는다. 명시되지 않은 패키지는 다른 모듈에서 사용할 수 없는 패키지가 된다. 이를 hidden packages 또는 encapsulated packages라 한다. 이는 그 패키지의 모듈 내부에서만 사용된다.
2. 마찬가지로 모듈이 다른 모듈을 사용하고 싶다면 require 문을 사용해 명시해야 한다.
3. 어떤 패키지를 exports 했다고 해서 그 패키지의 모든 하위 패키지까지 exports 되는 것은 아니다. 
4. 모듈 간에 순환 의존 관계(Circular dependencies)를 가질 수 없다. a 패키지가 b 패키지를 requires 하면 b 패키지는 a 패키지를 requires 할 수 없다.

### 모듈 수준의 캡슐화
자바는 패키지 수준에서 public, protected, default(패키지 수준), private의 접근 제어자를 제공했다. 하지만 이제 모듈을 통해 모듈 외부에서 public, 특정 모듈에만 public, 모듈 내부에서 public, protected, default(패키지 수준), private으로 캡슐화 수준이 확장되었다.  

## 참고
https://live-everyday.tistory.com/208  
https://infoscis.github.io/2017/03/24/First-steps-with-java9-and-jigsaw-part-1/  